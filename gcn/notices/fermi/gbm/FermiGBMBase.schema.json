{
  "$id": "https://gcn.nasa.gov/schema/main/gcn/notices/fermi/gbm/FermiGBMBase.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Schema for Fermi GBM GCN notices",
  "description": "This schema is used to report on Fermi GBM transients, incl. detections from the gorund subthreshold search.",
  "type": "object",
  "allOf": [
    { "$ref": "../../core/AdditionalInfo.schema.json" },
    {
      "properties": {
        "additional_info": {
          "default": ""
        }
      }
    },

    { "$ref": "../../core/Alert.schema.json" },
    { "required": ["alert_datetime", "alert_tense", "alert_type"] },

    { "$ref": "../../core/DateTime.schema.json" },
    { "required": ["trigger_time"] },
    { "not": { "required": ["observation_start"] } },
    { "not": { "required": ["observation_stop"] } },
    { "not": { "required": ["observation_livetime"] } },

    { "$ref": "../../core/Event.schema.json" },
    { "not": { "required": ["far"] } },
    { "not": { "required": ["net_count_rate"] } },
    { "not": { "required": ["background_count_rate"] } },
    { "not": { "required": ["image_snr"] } },
    { "not": { "required": ["image_duration"] } },
    { "not": { "required": ["image_energy_range"] } },
    { "not": { "required": ["p_astro"] } },
    { "not": { "required": ["properties"] } },

    { "$ref": "../../core/Reporter.schema.json" },
    { "not": { "required": ["filter"] } },
    { "required": ["mission", "instrument"] },
    {
      "properties": {
        "mission": {
          "const": "Fermi"
        },
        "instrument": {
          "const": "GBM"
        },
        "messenger": {
          "const": "EM",
          "default": "EM"
        },
        "spectrum": {
          "const": "energy",
          "default": "energy"
        },
        "units": {
          "const": "keV",
          "default": "keV"
        }
      }
    },

    { "$ref": "../../core/Statistics.schema.json" },
    { "not": { "required": ["best_fit_model"] } },
    { "not": { "required": ["spectral_energy_range"] } },
    { "not": { "required": ["hardness_ratio"] } },
    { "not": { "required": ["hardness_ratio_energy_range"] } },
    { "not": { "required": ["photon_flux_error"] } },
    { "not": { "required": ["energy_flux"] } },
    { "not": { "required": ["energy_flux_error"] } },
    { "not": { "required": ["flux_energy_range"] } },
    { "not": { "required": ["flux_time_range"] } },
    { "not": { "required": ["fluence"] } },
    { "not": { "required": ["fluence_error"] } },
    {
      "properties": {
        "trigger_type": {
          "const": "rate",
          "default": "rate"
        }
      }
    },

    {
      "properties": {
        "NOTICE_TYPE": {
          "enum": [
            "FERMI_GBM_ALERT",
            "FERMI_GBM_FLIGHT_POS",
            "FERMI_GBM_GND_POS",
            "FERMI_GBM_FINAL_POS",
            "FERMI_GBM_SUBTHRESHOLD"
          ],
          "description": "Indicates whether this notice was issued on the ground or in flight.  The Alert and the Flight Position notices are designed to be generated in flight, but sometimes they originate on the ground.  The Ground, Final and Subthreshold notices are always generated on the ground."
        },
        "GROUND_GENERATED_NOTICE": {
          "type": "boolean",
          "default": false,
          "description": "Indicates whether this notice was issued on the ground or in flight.  The Alert and the Flight Position notices are designed to be generated in flight, but sometimes they originate on the ground.  The Ground, Final and Subthreshold notices are always generated on the ground."
        },
        "HITL": {
          "type": "boolean",
          "default": false,
          "description": "(Human-in-the-Loop) Indicates whether a human was involved anywhere during this notice proessing "
        }
      }
    },
    { "required": ["NOTICE_TYPE"] }
  ]
}
